{% extends 'pdftranslate/base.html' %}

{% block title %}{{ video.title }} - {{ block.super }}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- Video Player Column -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-lg rounded-4 overflow-hidden mb-4">
                <!-- Video Player -->
                <div class="ratio ratio-16x9">
                    <video controls class="object-fit-cover">
                        <source src="{{ video.video_file.url }}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
                
                <!-- Video Info -->
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h1 class="h3 mb-0">{{ video.title }}</h1>
                        <span class="badge bg-success rounded-pill px-3">
                            Transcription Complete
                        </span>
                    </div>
                    
                    <div class="text-muted small">
                        <div class="mb-2">
                            <i class="bi bi-clock me-2"></i>
                            Uploaded on {{ video.uploaded_at|date:"F d, Y" }}
                        </div>
                        <div>
                            <i class="bi bi-translate me-2"></i>
                            Target Language: {{ video.get_target_language_display }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Transcription Column -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-lg rounded-4 h-100">
                <div class="card-header bg-white border-0 py-3">
                    <h2 class="h5 mb-0">
                        <i class="bi bi-file-text text-primary me-2"></i>
                        Transcription
                    </h2>
                </div>
                
                <div class="card-body">
                    <div class="transcription-text">
                        {{ video.extracted_text|linebreaks }}
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="card-footer bg-white border-0 py-3">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary" onclick="copyTranscription()">
                            <i class="bi bi-clipboard me-2"></i>
                            Copy to Clipboard
                        </button>
                        <a href="{% url 'video_list' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left me-2"></i>
                            Back to Videos
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.transcription-text {
    max-height: calc(100vh - 400px);
    overflow-y: auto;
    padding-right: 1rem;
}

.transcription-text::-webkit-scrollbar {
    width: 6px;
}

.transcription-text::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.transcription-text::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 3px;
}

.transcription-text::-webkit-scrollbar-thumb:hover {
    background: #555;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
function copyTranscription() {
    const text = `{{ video.extracted_text|escapejs }}`;
    navigator.clipboard.writeText(text).then(() => {
        const button = document.querySelector('.btn-outline-primary');
        const originalHtml = button.innerHTML;
        button.innerHTML = '<i class="bi bi-check2 me-2"></i>Copied!';
        button.classList.add('btn-success');
        button.classList.remove('btn-outline-primary');
        
        setTimeout(() => {
            button.innerHTML = originalHtml;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline-primary');
        }, 2000);
    });
}

// Add video time markers
document.addEventListener('DOMContentLoaded', function() {
    const video = document.querySelector('video');
    const transcriptionText = document.querySelector('.transcription-text');
    
    video.addEventListener('timeupdate', function() {
        // You can add functionality here to highlight the current part
        // of the transcription based on video time if timestamps are available
    });
});
</script>
{% endblock %} 